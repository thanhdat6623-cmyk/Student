#include <main.h>

unsigned int16 n = 999;

#int_timer0
void Ngat_timer0(void) {
    set_timer0(100);

    if (!input(PIN_D0)) {
        while (!input(PIN_D0)) {
        }
        n++;
    }

    if (!input(PIN_D1)) {
        while (!input(PIN_D1)) {
        }
        n--;
    }

    if (n > 999) {
        n = 0;
    }
}

unsigned int seg(unsigned int num) {
    switch (num) {
    case 0:
        return 0xC0;
    case 1:
        return 0xF9;
    case 2:
        return 0xA4;
    case 3:
        return 0xB0;
    case 4:
        return 0x99;
    case 5:
        return 0x92;
    case 6:
        return 0x82;
    case 7:
        return 0xF8;
    case 8:
        return 0x80;
    case 9:
        return 0x90;
    default:
        return 0xFF;
    }
}

void hienso(unsigned int16 so) {
    unsigned int16 digit, digit1, digit10, digit100;

    output_c(0x04);
    digit = so % 10;
    digit1 = seg(digit);
    output_b(digit1);
    delay_ms(1000);
    
    output_c(0x02);
    digit = (so / 10) % 10;
    digit10 = seg(digit);
    output_b(digit10);
    delay_ms(1000);
    
    output_c(0x01);
    digit = (so / 100) % 10;
    digit100 = seg(digit);
    output_b(digit100);
    delay_ms(1000);
}

void main() {
    set_tris_D(0xff);
    setup_timer_0(RTCC_INTERNAL | RTCC_DIV_4);
    set_timer0(100);
    enable_interrupts(int_timer0);
    enable_interrupts(global);

    while (TRUE) {
        hienso(n);
    }
}

